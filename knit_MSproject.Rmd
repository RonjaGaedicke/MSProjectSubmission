---
title: "Students' Alcohol Consumption Impacts on Academic Results on the Example of a Secondary Scool Maths Class in Portugal"
author: "Group 2"
date: "13 October 2016"
output: html_document
Data set source: P. Cortez and A. Silva. Using Data Mining to Predict Secondary School Student Performance. In A. Brito and J. Teixeira Eds., Proceedings of 5th FUture BUsiness TEChnology Conference (FUBUTEC 2008) pp. 5-12, Porto, Portugal, April, 2008, EUROSIS, ISBN 978-9077381-39-7. 

---

```{r setup,include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

---

Content: 

1. Introduction

2. Dataset Description and Descriptive Statistics

    + a. General Information
    + b. Family
    + c. Education 
    + d. Social Life and Health
    + e. Grades 
     
    
3. Hypothesis Testing

4. Correlation Analysis and Regression

5. Interesting Findings 

6. Conclusion

7. References

8. Appendices

=======

## 1. Introduction 
Recent events in the world economy have lead to the decline in economic performance in many countries, amongst which is the decline of economic growth in the European Union (EU).  As a response to these changes,  the EU has made it a priority to reverse this trend through investments that would provide new jobs and create a better educated workforce. Hence, the European Commission (EC) has set up a ‘Strategy for smart, sustainable and inclusive growth’ (European Comission, 2010), where a crucial part of investment is to contribute to the education of the next generations: The aim is to reduce the share of early school leavers to below 10% and ensure that at least 40% of the younger generation obtain a tertiary degree. 

The implementation of this strategy would use up siginificant amounts of resources; therefore, ensuring its success is crucial.  However, some factors affect the effectiveness of this strategy by lowering the academic performance of students, despite the investments going into the education system.  In an effort to identify one of those factors, this paper looks into the effect of alcohol consumption on the academic performance of students.  The consequences of high alcohol consumption is a field with a vast amount of literature and scientific studies, all of which point to the health, social and economic effects of alcohol consumption.  For example, a study by Keng and Huffman (2010) has found a relationship between alcohol abuse and poor labor market outcomes.  The choice of alcohol consumption as hindering factor the success of the EC's strategy was therefore motivated to test whether these consequences extend to academic performance as well.

The dataset used for this paper contains information about students in Portugal at the secondary school level. Portugal is among the world's highest alcohol consuming countries worldwide, ranked as the tenth highest alcohol consuming country per capita (Statitsa, 2016). In addition, Portugal is ranked amongst the top five OECD countries with the largest percentage of adults who have not attained secondary education in 2013, with a high percentage of 65% compared to an OECD average of 25%.  This is coupled with the fact that unemployment affected adults without a secondary education more severely than it did those with tertiary education (OECD, 2013). 

=======

## 2. Dataset Description and Descriptive Statistics 
```{r a, include=FALSE}
########################## Read csv file########################
sm <- read.csv("/Users/deasysibarani/Desktop/Math_Statistics_Foundations/Group Project/student/student-mat.csv", sep=';') 
# academic performance is measured by the average of exam scores
sm[, "Score"] <- (sm[, "G1"] + sm[, "G2"] + sm[, "G3"])/3


############## Variable modification/derivation ################

# 1. father or mother job is teacher = 1
sm$f_or_mteach <- 0
sm[,"f_or_mteach"] <- as.character(sm[,"f_or_mteach"])
for (j in 1:nrow(sm)) {

  if (sm[j, "Fjob"] == "teacher") sm[j,"f_or_mteach"] <- 1
  if (sm[j, "Mjob"] == "teacher") sm[j,"f_or_mteach"] <- 1
}
sm[,"f_or_mteach"] <- as.numeric(sm[,"f_or_mteach"])


# 2. father or mother earns university degree = 1 
sm$f_or_medu <- 0
sm[,"f_or_medu"] <- as.character(sm[,"f_or_medu"])
for (j in 1:nrow(sm)) {

  if (sm[j, "Medu"] == 4) sm[j,"f_or_medu"] <- 1
  if (sm[j, "Fedu"] == 4) sm[j,"f_or_medu"] <- 1
}
sm[,"f_or_medu"] <- as.numeric(sm[,"f_or_medu"])

# 3. want to take higher education = 1

sm$higher_ed <- 0
sm[,"higher_ed"] <- as.character(sm[,"higher_ed"])
for (j in 1:nrow(sm)) {

  if (sm[j, "higher"] == "yes") sm[j,"higher_ed"] <- 1
  if (sm[j, "higher"] == "yes") sm[j,"higher_ed"] <- 1
}
sm[,"higher_ed"] <- as.numeric(sm[,"higher_ed"])

################################################################################


# Descriptive statistics
library(ggplot2)
library(gridExtra)

meanAge <- mean(sm[,'age']) #16.696
medianAge <- median(sm[,'age']) #17 
summary(sm[,'sex']) #F=208 #M=187
summary(sm[,'school']) #Gabriel Pereira = 349   #Mousinho da Silveira = 46
summary(sm[,'address']) #Rural = 77 #Urban = 307
summary(sm[,'famsize']) #Greater than 3 = 281 #Less than 3 = 114
summary(sm[,'Pstatus']) #A = 41 #T = 354
summary(sm[,'internet']) #no = 66 #yes=329
summary(sm[,'romantic']) #no=263 #yes=132

########################################################
# Blank Theme for Pie Charts below

blank_theme <- theme_minimal()+ theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    panel.border = element_blank(),
    panel.grid=element_blank(),
    axis.ticks = element_blank(),
    plot.title=element_text(size=14, face="bold")
  )
########################################################
# Sex
summary(sm[,'sex']) 
#F=208 #M=187
df_gender <- data.frame(Gender=c("Female", "Male"), value=c(208, 187))
pie_gender <- ggplot(data=df_gender, aes(x="", y=value, fill=Gender)) + 
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start=0) + 
  scale_fill_brewer() + blank_theme + 
  theme(axis.text.x=element_blank()) +
  geom_text(aes(y = value/3 + 
  c(0, cumsum(value)[-length(value)]), label = (value)), size=4, show.legend=FALSE) +
  ggtitle("Student's Gender")


###
# Address
summary(sm[,'address']) 
#Rural = 77 #Urban = 307
df_address <- data.frame(Type=c("Rural", "Urban"), value=c(77, 307))
pie_address <- ggplot(data=df_address, aes(x="", y=value, fill=Type)) + 
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start=0) + 
  scale_fill_brewer() + blank_theme + 
  theme(axis.text.x=element_blank()) +
  geom_text(aes(y = value/3 + c(0, cumsum(value)[-length(value)]), label = (value)), size=4) +
  ggtitle("Student's Home Address Type")



###
#Study Time
#weekly study time (numeric: 1 - <2 hours, 2 - 2 to 5 hours, 3 - 5 to 10 hours, or 4 - >10 hours)
studyTime <- table(sm$studytime)
#  1   2   3   4 
# 105 198  65  27 

df_studyTime <- data.frame(Hours=c('<2 hours', "2 to 5 hours", "5 to 10 hours", ">10 hours"), value=c(105, 198, 65, 27))
bar_studytime <- ggplot(data=df_studyTime, aes(x="", y=value, fill=Hours)) + 
  geom_bar(width = 1, stat = "identity") + 
  scale_fill_brewer() + blank_theme + 
  theme(axis.text.x=element_blank()) +
  geom_text(aes(y = value/3 + c(0, cumsum(value)[-length(value)]), label = (value)), size=4) +
  ggtitle('Study Time')


###
# Failures
# number of past class failures (numeric: n if 1<=n<3, else 4)

failures <- table(sm$failures)
# 0   1   2   3 
# 312  50  17  16 
df_failures <- data.frame(Times=c("3", "2", "1", "0"), value=c(16, 17, 50, 312))
pie_failures <- ggplot(data=df_failures, aes(x="", y=value, fill=Times)) + 
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start=0) + 
  scale_fill_brewer() + blank_theme + 
  theme(axis.text.x=element_blank()) +
  geom_text(aes(y = value/3 + c(0, cumsum(value)[-length(value)]), label = (value)), size=4) +
  ggtitle('Number of Past Class Failures')


###
# Schools
summary(sm[,'school']) 
#Gabriel Pereira = 349   #Mousinho da Silveira = 46

df_school <- data.frame(Group=c("Gabriel Pereira", "Mousinho da Silveira"), value=c(349,46))
bar_school <- ggplot(data=df_school, aes(x="", y=value, fill=Group)) + 
  geom_bar(width = 1, stat = "identity") + 
  scale_fill_brewer() + blank_theme + 
  theme(axis.text.x=element_blank()) +
  geom_text(aes(y = value/3 + c(0, cumsum(value)[-length(value)]), label = (value)), size=4) +
  ggtitle('School')


###
# Father's Job
summary(sm[,'Fjob'])
# at_home   health  other  services  teacher 
#   20       18      217      111       29 

df_fjob <- data.frame(Job = c("Health", "Work at Home", "Teacher", "Servies", "Other"), value = c(18, 20, 29, 111, 217))
pie_fjob <- ggplot(data = df_fjob, aes(x="", y=value, fill=Job)) + 
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start=0) + 
  scale_fill_brewer() + blank_theme +
  theme(axis.text.x=element_blank()) +
  geom_text(aes(y = value/3 + c(0, cumsum(value)[-length(value)]), label = (value)), size=3) +              ggtitle("Father's Job")


###
# Mother's Job
summary(sm[,'Mjob'])
# at_home   health  other  services  teacher 
# 59       34        141      103       58

df_mjob <- data.frame(Job = c("Health", "Teacher", "Work at Home", "Services", "Other"), value = c(34, 58, 59, 103, 141))
pie_mjob <- ggplot(data = df_mjob, aes(x="", y=value, fill=Job)) + 
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start=0) + 
  scale_fill_brewer() + blank_theme +
  theme(axis.text.x=element_blank()) +
  geom_text(aes(y = value/3 + c(0, cumsum(value)[-length(value)]), label = (value)), size=3) +
  ggtitle("Mother's Job")


###
# Student's Guardian
summary(sm[,'guardian'])
# father mother  other 
# 90    273     32 

df_guardian <- data.frame(Type = c("Father", "Mother", "Other"), value = c(90, 273, 32))
pie_guardian <- ggplot(data = df_guardian, aes(x="", y=value, fill=Type)) + 
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start=0) + 
  scale_fill_brewer() + blank_theme +
  theme(axis.text.x=element_blank()) +
  geom_text(aes(y = value/3 + c(0, cumsum(value)[-length(value)]), label = (value)), size=3) +
  ggtitle("Guardian")
```

The dataset examined provides sample data of two secondary schools in Portugal, providing a total of 395 objects (students) and 33 variables (items on information on each student). A list of all variables and their description can be found in Appendix A. The data can be grouped into five areas of information: 

#### a. General Information
General information about the students include gender, address and age. From the descriptive statistics (section 3) we can derive that the age from the students in this dataset ranges from 15 to 22 years with an average of 16.7 years. Out of the total of 395, there are 52.7% female and 47.3% male students. Most students would live in an urban environment, while approx. 20% live in an rural environment. 
```{r b, echo=FALSE}
grid.arrange(pie_gender, pie_address, ncol=2)
```
#### b. Family  
Information in the students families includes the family size, educational background of their parents and their jobs, and the student's guardian. 

```{r c, echo=FALSE}
grid.arrange(pie_guardian, pie_fjob, pie_mjob, widths = c(1, 1, 2), layout_matrix = rbind(c(1,1,1), c(2,2,3)))
```

#### c. Education
The education section of this dataset covers the split between the two schools observed, why each student has chosen that particular school, and how long it takes each student to get to school. In addition, it provides information on the student's study time, extra educational support or classes taken and if the student is involved in extra curricular activities. Finally, there is data on their previous education and aspirations on whether to go into higher education. 

```{r d, echo=FALSE}
grid.arrange(bar_studytime, bar_school, ncol=2)

```

#### d. Social Life and Health 
The social life section provides information on activities the student is involved in outside of school. This includes how much leisure time they have, whether they are in a relationship and how often they go out. Moreover, there is data on how much alcohol students consume and in what health condition they are in. 

#### e. Grades
The grades are split into three grades: the first period (G1), second period (G2) and final grade (G3). For the purpose of this analysis, students academic performance will be measured as the average of all three grades. In addition, there is information on whether they have failed to pass any classes. 


```{r e, echo=FALSE}
pie_failures
```

=======

## 3. Hypothesis Testing

As aforementioned, this paper will look into whether alcohol is one of the factors affecting academic performance. Our basic assumption is alcohol consumption has a negative impact on students grade (Ho). To test this hypothesis, multivariate regression analysis will be applied on the 395 sample of students described above. This will allow us to see the significant factors that contribute to academic performance, and check whether or not alcohol consumption is one of them. In this regression, grade is assigned as the dependent variable, and all other variables are treated as independent variable. If alcohol appeared as one of the significant variables in the regression, the null hypothesis can not be rejected, inferring that alcohol **is** one of the variables related to academic performance. 

=======

## 4. Correlation Analysis and Regression

Prior to regression, there are several items that need to be inspected :


    a) Distribution of Response Variable
    
    If the distribution is highly skewed, linear regression might not give a good approximation or response varible.         Thus, variable transformation might be required, or applying other regression method might be more appropriate.
    
    b) Correlation Analysis
    
    Correlation between response and explanatory variables is required to get a general view of the variables   relationships. In addition, correlation between explanatory variables will also be assessed to avoid multicollinearity problem, as well as to provide other insights from the data.  

### a. Distribution of Response Variable



```{r f, echo=FALSE}
sm[,"Score"] <- (sm[,"G1"] + sm[,"G2"] + sm[,"G3"])/3

ggplot(sm) + geom_density(aes(x=Score, fill = Score, colour = Score)) + labs(x = "Academic Score", y="% Frequency", title = "Academic Score of Secondary School Student")
```


As seen from the graph, the distribution is slightly left-skewed, but very close to normal distribution. Thus, multivariate regression method is appropriate to be applied to test the hypothesis, and no variable transformation required.

### b. Correlation Analysis

After performing correlation of all explanatory variables against grade (response variable), a few variables appear to have high correlation to grade :

1) Parent's Education
```{r g, echo=FALSE}
cor.test(sm[,"f_or_medu"],sm[,"Score"])
```
The correlation with grade is 0.23 With 95% confidence interval and p-value result of 3.586e-06, we can reject the null hypothesis of there is no correlation between these two variables. This means that parent's education has positive correlation with grade, and that students who have parents with university degree are more likely to have higher scores than those who do not.

2) Want to have higher education
```{r h, echo=FALSE}
cor.test(sm[,"higher_ed"],sm[,"Score"])
```
The correlation with grade is 0.189. With 95% confidence interval and p-value result of 0.0001517, we can reject the null hypothesis of there is no correlation between these two variables, and that grade does correlate positively with their aspiration to take higher education. 

3) Number of past class failure
```{r i, echo=FALSE}
cor.test(sm$Score,sm$failures) 
```
The correlation with grade is -0.375. With 95% confidence interval and p-value result of 1.08e-14, we can reject the null hypothesis of there is no correlation between these two variables, and conclude that indeed, number of past class failure is negatively correlated with grade. students who have higher number of class failures in the past are more likely to have lower grade.

4) Frequency of going out with friends
```{r i1, echo=FALSE}
cor.test(sm$Score,sm$goout)
```

The correlation with grade is -0.154. With 95% confidence interval and p-value result of 0.002073, we can reject the null hypothesis of there is no correlation between these two variables, and conclude that indeed, the frequency of going out with friends are negatively correlated with grade. students who goes out more are more likely to have lower grade.

Alcohol does not have a significant correlation to grade, as shown in the correlation result result below :

```{r i2, echo=FALSE}
cor.test(sm$Score,sm$Walc)
```
The correlation shown is -0.08. With 95% confidence interval and p-value result of 8%, we can not reject the null hypothesis of there is no correlation between these two variables, and conclude that there is no correlation significant correlation between alcohol and students' academic performance.


suggestion: here we put remi's part. However, while performing correlation among explanatory variables .... (intro to remi's):

```{r i3, echo=FALSE}

###REMI's###

```


### Regression

After assessing the correlations between all the variables, multivariate regression will be applied. Firstly, all variables are put in the regression. Then, variable with the highest p-value is eliminated from the model before the next regression is performed. This iteration is done until a model with satisfying R2 and consists of significant explanatory variables is derived. 

The end result of the regression is shown in the figure below.

Initial Regression :

```{r i4, echo=TRUE}
#Initial Regression

reg <- lm(Score ~ school + sex + age + address + famsize + Pstatus + Medu + Fedu + 
                Mjob + Fjob + reason + guardian + traveltime + studytime + failures + 
                schoolsup + famsup + paid + activities + nursery + higher + internet + 
                romantic + famrel + freetime + goout + Dalc + Walc + health + absences +
                f_or_mteach + f_or_medu
                , data = sm)
summary(reg)
```

```{r j, include=FALSE}

# Step wise variable selection
reg1 <- update(reg, . ~ . - guardian)
summary(reg1)
reg2 <- update(reg1, . ~ . - Fjob)
summary(reg2)
reg3 <- update(reg2, . ~ . - Medu)
summary(reg3)
reg4 <- update(reg3, . ~ . - Fedu)
summary(reg4)
reg5 <- update(reg4, . ~ . - famrel)
summary(reg5)
reg6 <- update(reg5, . ~ . - Walc)
summary(reg6)
reg7 <- update(reg6, . ~ . - Dalc)
summary(reg7)
reg8 <- update(reg7, . ~ . - paid)
summary(reg8)
reg9 <- update(reg8, . ~ . - nursery)
summary(reg9)
reg10 <- update(reg9, . ~ . - Pstatus)
summary(reg10)
reg11 <- update(reg10, . ~ . - school)
summary(reg11)
reg12 <- update(reg11, . ~ . - activities)
summary(reg12)
reg13 <- update(reg12, . ~ . - f_or_mteach)
summary(reg13)
reg14 <- update(reg13, . ~ . - internet)
summary(reg14)
reg15 <- update(reg14, . ~ . - Mjob)
summary(reg15)
reg16 <- update(reg15, . ~ . - reason)
summary(reg16)
reg17 <- update(reg16, . ~ . - age)
summary(reg17)
reg18 <- update(reg17, . ~ . - traveltime)
summary(reg18)
reg19 <- update(reg18, . ~ . - freetime)
summary(reg19)
reg20 <- update(reg19, . ~ . - famsize)
summary(reg20)
reg21 <- update(reg20, . ~ . - absences)
summary(reg21)
reg22 <- update(reg21, . ~ . - health)
summary(reg22)
reg23 <- update(reg22, . ~ . - higher)
summary(reg23)
reg24 <- update(reg23, . ~ . - romantic)
summary(reg24)

#To cross check on the final model and the significant variables, we use existing R library:
#library(MASS)
#step <- stepAIC(reg, direction="both")
```

**Figure 4. Final Regression Model**

```{r j1, echo=FALSE}
#Final Model

library(stargazer)
stargazer(reg24, type = "text", digits = 2)
```

From the regression result, we can see that alcohol consumption is not one of the significant variables that explains student academic performance. Instead, they are:

1) Sex

2) Address

3) Study time

4) Number of past class failure

5) Extra educational school support

6) Family educational support

7) Frequency of going out with friends

8) Parents level of education

The R2 is 21.74%, which means that the model can explain 21.74% of the variance in student's academic score. The residual plot shown below (figure ...) does not show a random dispersed around the x axis, which means the residual does not sum up to zero. There are other significant factors not captured in the dataset nor the model, that can contribute in explaining academic score. Some examples are IQ score, EQ score, nutrition, or time spent for physical exercise.



**Figure 5. Residual Plot**


```{r a1, echo=TRUE}
# residual plot
fit_res <-  data.frame(sm, fitted.value = fitted(reg24), residual = resid(reg24))

ggplot(data = fit_res) + geom_point(aes(x = Score, y = residual)) + geom_hline(yintercept = 0) + labs(x = "Academic Score", y= "residual", title = "Residual Plot of Academic Score Regression")
```


---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

